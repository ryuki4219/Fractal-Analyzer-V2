# 解像度補正AI 使用ガイド

## 概要
このアプリには、低解像度画像でも高解像度画像と同等のフラクタル次元を推定できる**解像度補正AI**機能が組み込まれています。

Googleの消しゴムマジックや背景補完のように、失われた情報（この場合は解像度）を機械学習で補完し、より正確なフラクタル次元を推定します。

## 機能の仕組み

### 1. 学習の流れ
```
高解像度画像 → 複数の低解像度バージョンを自動生成
                ↓
      各解像度でフラクタル次元を計算
                ↓
      特徴量抽出（テクスチャ、周波数、エッジ等）
                ↓
      機械学習モデル（Gradient Boosting）で学習
                ↓
      低解像度→高解像度フラクタル次元への変換モデル完成
```

### 2. 推論の流れ
```
低解像度画像 → 特徴量抽出
              ↓
        学習済みモデルで予測
              ↓
      高解像度相当のフラクタル次元を出力
```

## 使い方

### ステップ1: 学習データの生成

1. サイドバーの「🔬 解像度補正AI」セクションを見つける
2. 「学習データ生成モード」にチェックを入れる
3. 高解像度の画像ファイルをアップロード
4. アプリが自動的に以下を実行します：
   - 元画像の50%, 30%, 20%, 15%, 10%の解像度バージョンを生成
   - 各解像度でフラクタル次元を計算
   - 学習データとして保存（`resolution_training_data.csv`）

**推奨**: 様々な種類の画像（テクスチャ、パターン、自然画像等）で20～100枚程度の学習データを生成すると効果的です。

### ステップ2: モデルの学習

1. 学習データが十分に蓄積されたら
2. 「解像度補正モデルを学習」ボタンをクリック
3. 学習が完了すると、MAE（平均絶対誤差）とR²スコアが表示されます
4. モデルが`resolution_correction_model.pkl`として保存されます

### ステップ3: 解像度補正の利用

1. 「学習データ生成モード」のチェックを**外す**
2. 「解像度補正を有効化」にチェックを入れる
3. 低解像度の画像をアップロード
4. 結果表示に以下が追加されます：
   - **フラクタル次元（実測）**: 通常の計算結果
   - **フラクタル次元（AI補正後）**: 高解像度相当に補正された値
   - **補正量**: 実測値からの変化量

### ステップ4: 結果の確認

グラフには3種類の線が表示されます：
- **青色実線**: 実測値（低解像度で計算されたフラクタル次元）
- **緑色点線**: AI補正値（高解像度相当に補正された値）
- **赤色破線**: 従来のAI予測値（別の学習モデル）

## 技術的詳細

### 抽出される特徴量
1. **基本統計量**: 平均輝度、標準偏差
2. **エッジ特徴**: エッジ密度（Canny検出）
3. **テクスチャ特徴**: 局所的な分散の変動
4. **周波数特徴**: FFTによる高周波エネルギー
5. **画像サイズ情報**: 解像度、アスペクト比
6. **空間占有率**: 二値化後の白ピクセル比率
7. **フラクタル次元**: 低解像度で計算された値

### 使用モデル
- **Gradient Boosting Regressor**
  - n_estimators: 200
  - learning_rate: 0.05
  - max_depth: 5
  - 高精度かつ過学習を抑制

### 評価指標
- **MAE（平均絶対誤差）**: 予測値と真値の平均的な差
- **R²スコア**: モデルの説明力（1.0に近いほど良い）

## 活用例

### 1. 古い写真の解析
スキャンした低解像度の古い写真でも、元の高解像度相当のフラクタル次元を推定可能

### 2. リアルタイム処理
低解像度で高速に処理しつつ、高解像度相当の精度を維持

### 3. データ圧縮後の解析
圧縮された画像でも元画質のフラクタル特性を復元

## トラブルシューティング

### Q: 学習データが生成されない
A: 「学習データ生成モード」にチェックが入っているか確認してください

### Q: 補正が適用されない
A: 以下を確認してください：
- 「解像度補正を有効化」にチェックが入っているか
- モデルが学習済みか（サイドバーに「読み込み済み」表示があるか）

### Q: 補正精度が低い
A: 以下を試してください：
- より多様な画像で学習データを増やす
- アップロード画像と類似したタイプの画像で学習する
- 異なる解像度レベルの画像で学習する

## ファイル出力

### 生成されるファイル
- `resolution_training_data.csv`: 学習データ
- `resolution_correction_model.pkl`: 学習済みモデル
- `resolution_correction_scaler.pkl`: 特徴量スケーラー

## 今後の拡張案

1. **Deep Learning版**: CNN/Transformerを使用した高精度モデル
2. **マルチスケール学習**: より多段階の解像度で学習
3. **ドメイン適応**: 特定分野（医療画像、衛星画像等）に特化
4. **超解像との統合**: 画像自体を高解像度化してから解析

---
**開発者向け注意事項**: 
- モデルの再学習は既存モデルを上書きします
- 学習データは追記形式で保存されます
- 大量の学習データ生成時はディスク容量に注意してください
